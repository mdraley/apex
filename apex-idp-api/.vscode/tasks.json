{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Gateway: clean",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am clean",
      "options": { "cwd": "${workspaceFolder}" }
    },
    {
      "label": "Gateway: compile",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am clean compile",
      "options": { "cwd": "${workspaceFolder}" }
    },
    {
      "label": "Gateway: test",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am test",
      "options": { "cwd": "${workspaceFolder}" }
    },
    {
      "label": "Gateway: package (skip tests)",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am clean package -DskipTests",
      "options": { "cwd": "${workspaceFolder}" }
    },

    {
      "label": "Gateway: spring-boot:run (dev)",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am spring-boot:run -Dspring-boot.run.profiles=dev",
      "options": { "cwd": "${workspaceFolder}" }
    },
    {
      "label": "Gateway: spring-boot:run (prod)",
      "type": "shell",
      "command": "mvn -q -pl apex-api-gateway -am spring-boot:run -Dspring-boot.run.profiles=prod",
      "options": { "cwd": "${workspaceFolder}" }
    },

    {
      "label": "Gateway: run JAR (prod)",
      "type": "shell",
      "command": "powershell -NoProfile -Command \"$m='apex-api-gateway'; Get-ChildItem \"$m/target\" -Filter *.jar | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { java -jar $_.FullName }\"",
      "options": { "cwd": "${workspaceFolder}" },
      "dependsOn": "Gateway: package (skip tests)"
    },

    {
      "label": "Gateway: open Swagger",
      "type": "shell",
      "command": "powershell -NoProfile -Command \"Start-Process 'http://localhost:8080/api/swagger-ui/index.html'\"",
      "options": { "cwd": "${workspaceFolder}" }
    },
    {
      "label": "Gateway: health check",
      "type": "shell",
      "command": "powershell -NoProfile -Command \"Invoke-WebRequest -UseBasicParsing http://localhost:8080/actuator/health | Select-Object -ExpandProperty StatusCode\"",
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "never", "panel": "dedicated" }
    }
  ]
}
